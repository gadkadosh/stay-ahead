---
export const partial = true;

import CurrentScenario from "@/components/CurrentScenario.astro";
import { getScenarioWithPhases, updatePhase } from "@/data/db";

const id = Number(Astro.params.id);
const scenario = await getScenarioWithPhases(id);

if (Astro.request.method === "PUT") {
  const data = await Astro.request.formData();

  const updated = await Promise.all(
    Array.from(data).map((item) => {
      const id = Number(item[0].split(":")[1]);
      const duration = Number(item[1]);
      return updatePhase({ id, duration });
    }),
  );

  scenario.phases = updated;
}
---

<CurrentScenario scenario={scenario} />

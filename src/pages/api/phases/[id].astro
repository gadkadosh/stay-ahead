---
export const partial = true;

import Phase from "@/components/Phase.astro";
import { getPhase, updatePhase } from "@/data/db";

const id = Number(Astro.params.id);
const { method } = Astro.request;

let returned: undefined | Awaited<ReturnType<typeof updatePhase>>;

if (method === "PUT") {
  const data = await Astro.request.formData();
  const duration = Number(data.get("duration"));
  if (Number.isInteger(duration)) {
    returned = await updatePhase({
      id,
      duration,
    });
    Astro.response.headers.set("HX-Trigger", "updateScenario");
  }
}

const phase = returned || (await getPhase(Number(id)));
---

<Phase phase={phase} order={1} />
